import { useState } from 'react';
import { useHistory } from './useHistory';

interface FeedbackData {
  correct: string;
  mistakes: string;
  advice: string;
  accuracy: number;
  clarity: number;
}

const TOPICS_BY_SUBJECT = {
  'æ•°å­¦': [
    "ä¸€æ¬¡é–¢æ•°ã¨ã¯ï¼Ÿ",
    "äºŒæ¬¡æ–¹ç¨‹å¼ã®è§£ãæ–¹ã¨ã¯ï¼Ÿ",
    "ä¸‰è§’æ¯”ã®åŸºæœ¬ã¨ã¯ï¼Ÿ",
    "ç¢ºç‡ã®è¨ˆç®—æ–¹æ³•ã¨ã¯ï¼Ÿ"
  ],
  'ç†ç§‘': [
    "é£Ÿç‰©é€£é–ã¨ã¯ï¼Ÿ",
    "ç´°èƒåˆ†è£‚ã¨ã¯ä½•ã‹ï¼Ÿ",
    "æ…£æ€§ã®æ³•å‰‡ã«ã¤ã„ã¦èª¬æ˜ã›ã‚ˆã€‚",
    "å…‰åˆæˆã®ä»•çµ„ã¿ã¨ã¯ï¼Ÿ",
    "é…¸åŒ–ã¨é‚„å…ƒã¨ã¯ï¼Ÿ"
  ],
  'ç¤¾ä¼š': [
    "éŒå€‰å¹•åºœã®ç‰¹å¾´ã¨ã¯ï¼Ÿ",
    "æ˜æ²»ç¶­æ–°ã¨ã¯ä½•ã‹ï¼Ÿ",
    "GDPã¨ã¯ä½•ã‹ï¼Ÿ",
    "ä¸‰æ¨©åˆ†ç«‹ã¨ã¯ï¼Ÿ"
  ],
  'ç’°å¢ƒãƒ»åœ°ç†': [
    "SDGsã®æ„å‘³ã¨ç›®çš„ã¨ã¯ï¼Ÿ",
    "åœ°éœ‡ã¨æ´¥æ³¢ã®é–¢ä¿‚ã¨ã¯ï¼Ÿ",
    "å¤©æ°—ã¨æ°—å€™ã®é•ã„ã¯ï¼Ÿ",
    "æŒç¶šå¯èƒ½ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨ã¯ï¼Ÿ",
    "åœ°çƒæ¸©æš–åŒ–ã®åŸå› ã¨ã¯ï¼Ÿ"
  ]
};

const ALL_TOPICS = Object.values(TOPICS_BY_SUBJECT).flat();

const TOPIC_ANSWERS: { [key: string]: string } = {
  "ä¸€æ¬¡é–¢æ•°ã¨ã¯ï¼Ÿ": "ä¸€æ¬¡é–¢æ•°ã¨ã¯ã€y = ax + bï¼ˆa â‰  0ï¼‰ã®å½¢ã§è¡¨ã•ã‚Œã‚‹é–¢æ•°ã§ã™ã€‚aã¯å‚¾ãã‚’è¡¨ã—ã€bã¯yåˆ‡ç‰‡ã‚’è¡¨ã—ã¾ã™ã€‚ã‚°ãƒ©ãƒ•ã¯ç›´ç·šã«ãªã‚Šã€xã®å€¤ãŒ1å¢—åŠ ã™ã‚‹ã¨yã®å€¤ã¯aå¢—åŠ ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€y = 2x + 3ã§ã¯ã€å‚¾ããŒ2ã€yåˆ‡ç‰‡ãŒ3ã®ç›´ç·šã¨ãªã‚Šã¾ã™ã€‚",
  
  "äºŒæ¬¡æ–¹ç¨‹å¼ã®è§£ãæ–¹ã¨ã¯ï¼Ÿ": "äºŒæ¬¡æ–¹ç¨‹å¼axÂ² + bx + c = 0ï¼ˆa â‰  0ï¼‰ã®è§£ãæ–¹ã«ã¯ã€å› æ•°åˆ†è§£ã€è§£ã®å…¬å¼ã€å¹³æ–¹å®ŒæˆãŒã‚ã‚Šã¾ã™ã€‚è§£ã®å…¬å¼ã¯ x = (-b Â± âˆš(bÂ²-4ac)) / 2a ã§ã™ã€‚åˆ¤åˆ¥å¼D = bÂ²-4acã«ã‚ˆã‚Šã€D > 0ãªã‚‰ç•°ãªã‚‹2ã¤ã®å®Ÿæ•°è§£ã€D = 0ãªã‚‰é‡è§£ã€D < 0ãªã‚‰å®Ÿæ•°è§£ãªã—ã¨ãªã‚Šã¾ã™ã€‚",
  
  "ä¸‰è§’æ¯”ã®åŸºæœ¬ã¨ã¯ï¼Ÿ": "ä¸‰è§’æ¯”ã¨ã¯ã€ç›´è§’ä¸‰è§’å½¢ã«ãŠã„ã¦è§’ã¨è¾ºã®æ¯”ã‚’è¡¨ã—ãŸã‚‚ã®ã§ã™ã€‚sinÎ¸ = å¯¾è¾º/æ–œè¾ºã€cosÎ¸ = éš£è¾º/æ–œè¾ºã€tanÎ¸ = å¯¾è¾º/éš£è¾ºã§å®šç¾©ã•ã‚Œã¾ã™ã€‚ç‰¹åˆ¥ãªè§’ï¼ˆ30Â°ã€45Â°ã€60Â°ï¼‰ã®ä¸‰è§’æ¯”ã®å€¤ã¯é‡è¦ã§ã€æ§˜ã€…ãªè¨ˆç®—ã§ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚",
  
  "ç¢ºç‡ã®è¨ˆç®—æ–¹æ³•ã¨ã¯ï¼Ÿ": "ç¢ºç‡ã¨ã¯ã€ã‚ã‚‹äº‹è±¡ãŒèµ·ã“ã‚‹å¯èƒ½æ€§ã‚’æ•°å€¤ã§è¡¨ã—ãŸã‚‚ã®ã§ã™ã€‚ç¢ºç‡ = äº‹è±¡ãŒèµ·ã“ã‚‹å ´åˆã®æ•° / å…¨ã¦ã®å ´åˆã®æ•° ã§è¨ˆç®—ã—ã¾ã™ã€‚0 â‰¤ P â‰¤ 1ã®ç¯„å›²ã§ã€0ã¯çµ¶å¯¾èµ·ã“ã‚‰ãªã„ã€1ã¯å¿…ãšèµ·ã“ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚ç‹¬ç«‹äº‹è±¡ã®åŒæ™‚ç¢ºç‡ã¯å„ç¢ºç‡ã®ç©ã§æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚",
  
  "é£Ÿç‰©é€£é–ã¨ã¯ï¼Ÿ": "é£Ÿç‰©é€£é–ã¨ã¯ã€ç”Ÿæ…‹ç³»ã«ãŠã„ã¦ç”Ÿç‰©ãŒã€Œé£Ÿã¹ã‚‹ãƒ»é£Ÿã¹ã‚‰ã‚Œã‚‹ã€ã®é–¢ä¿‚ã§ã¤ãªãŒã£ã¦ã„ã‚‹ä»•çµ„ã¿ã§ã™ã€‚æ¤ç‰©ï¼ˆç”Ÿç”£è€…ï¼‰â†’è‰é£Ÿå‹•ç‰©ï¼ˆä¸€æ¬¡æ¶ˆè²»è€…ï¼‰â†’è‚‰é£Ÿå‹•ç‰©ï¼ˆäºŒæ¬¡æ¶ˆè²»è€…ï¼‰â†’ã‚ˆã‚Šå¤§ããªè‚‰é£Ÿå‹•ç‰©ï¼ˆä¸‰æ¬¡æ¶ˆè²»è€…ï¼‰ã¨ã„ã†é †åºã§ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨æ „é¤ŠãŒç§»å‹•ã—ã¾ã™ã€‚æœ€çµ‚çš„ã«åˆ†è§£è€…ï¼ˆç´°èŒãªã©ï¼‰ãŒã™ã¹ã¦ã‚’åˆ†è§£ã—ã€æ „é¤Šã‚’åœŸå£Œã«æˆ»ã—ã¾ã™ã€‚",
  
  "å…‰åˆæˆã®ä»•çµ„ã¿ã¨ã¯ï¼Ÿ": "å…‰åˆæˆã¨ã¯ã€æ¤ç‰©ãŒå…‰ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ä½¿ã£ã¦äºŒé…¸åŒ–ç‚­ç´ ã¨æ°´ã‹ã‚‰æœ‰æ©Ÿç‰©ï¼ˆãƒ–ãƒ‰ã‚¦ç³–ï¼‰ã‚’ä½œã‚‹åå¿œã§ã™ã€‚åŒ–å­¦å¼ã¯ 6COâ‚‚ + 6Hâ‚‚O + å…‰ã‚¨ãƒãƒ«ã‚®ãƒ¼ â†’ Câ‚†Hâ‚â‚‚Oâ‚† + 6Oâ‚‚ ã§ã™ã€‚è‘‰ç·‘ä½“ã®ã‚¯ãƒ­ãƒ­ãƒ•ã‚£ãƒ«ãŒå…‰ã‚’å¸åã—ã€æ˜åå¿œã¨æš—åå¿œï¼ˆã‚«ãƒ«ãƒ“ãƒ³å›è·¯ï¼‰ã®2æ®µéšã§é€²è¡Œã—ã¾ã™ã€‚",
  
  "é…¸åŒ–ã¨é‚„å…ƒã¨ã¯ï¼Ÿ": "é…¸åŒ–ã¨ã¯ç‰©è³ªãŒé…¸ç´ ã¨çµåˆã™ã‚‹ã€ã¾ãŸã¯é›»å­ã‚’å¤±ã†åå¿œã§ã™ã€‚é‚„å…ƒã¨ã¯é…¸ç´ ã‚’å¤±ã†ã€ã¾ãŸã¯é›»å­ã‚’å¾—ã‚‹åå¿œã§ã™ã€‚é…¸åŒ–ã¨é‚„å…ƒã¯å¿…ãšåŒæ™‚ã«èµ·ã“ã‚Šï¼ˆé…¸åŒ–é‚„å…ƒåå¿œï¼‰ã€ä¸€æ–¹ãŒé…¸åŒ–ã•ã‚Œã‚‹ã¨ä»–æ–¹ãŒé‚„å…ƒã•ã‚Œã¾ã™ã€‚ä¾‹ï¼š2Mg + Oâ‚‚ â†’ 2MgOï¼ˆMgãŒé…¸åŒ–ã€Oâ‚‚ãŒé‚„å…ƒï¼‰",
  
  "éŒå€‰å¹•åºœã®ç‰¹å¾´ã¨ã¯ï¼Ÿ": "éŒå€‰å¹•åºœï¼ˆ1185-1333å¹´ï¼‰ã¯ã€æºé ¼æœãŒé–‹ã„ãŸæ—¥æœ¬åˆã®æ­¦å®¶æ”¿æ¨©ã§ã™ã€‚ä¸»ãªç‰¹å¾´ã¯ï¼šâ‘ å°†è»ã‚’é ‚ç‚¹ã¨ã™ã‚‹æ­¦å£«ã«ã‚ˆã‚‹æ”¿æ²»ã€â‘¡å®ˆè­·ãƒ»åœ°é ­åˆ¶åº¦ã«ã‚ˆã‚‹åœ°æ–¹çµ±æ²»ã€â‘¢å¾¡å®¶äººåˆ¶åº¦ã«ã‚ˆã‚‹ä¸»å¾“é–¢ä¿‚ã€â‘£æœå»·ã¨ä¸¦å­˜ã™ã‚‹äºŒé‡æ”¿æ²»æ§‹é€ ã§ã™ã€‚äº¬éƒ½ã®æœå»·ãŒå½¢å¼çš„æ¨©å¨ã‚’ä¿ã¡ãªãŒã‚‰ã€å®Ÿéš›ã®æ”¿æ²»ã¯éŒå€‰ã§è¡Œã‚ã‚Œã¾ã—ãŸã€‚",
  
  "æ˜æ²»ç¶­æ–°ã¨ã¯ä½•ã‹ï¼Ÿ": "æ˜æ²»ç¶­æ–°ã¨ã¯ã€1868å¹´é ƒã‹ã‚‰å§‹ã¾ã£ãŸæ—¥æœ¬ã®è¿‘ä»£åŒ–æ”¹é©ã§ã™ã€‚æ±Ÿæˆ¸å¹•åºœãŒå€’ã‚Œã€å¤©çš‡ä¸­å¿ƒã®æ–°æ”¿åºœãŒæˆç«‹ã—ã¾ã—ãŸã€‚å»ƒè—©ç½®çœŒã€èº«åˆ†åˆ¶åº¦ã®å»ƒæ­¢ã€æ–‡æ˜é–‹åŒ–ã€å¯Œå›½å¼·å…µæ”¿ç­–ãªã©ã«ã‚ˆã‚Šã€å°å»ºç¤¾ä¼šã‹ã‚‰è¿‘ä»£å›½å®¶ã¸ã®è»¢æ›ã‚’å›³ã‚Šã¾ã—ãŸã€‚è¥¿æ´‹ã®æŠ€è¡“ã‚„åˆ¶åº¦ã‚’ç©æ¥µçš„ã«å–ã‚Šå…¥ã‚Œã€æ€¥é€Ÿãªè¿‘ä»£åŒ–ã‚’å®Ÿç¾ã—ã¾ã—ãŸã€‚",
  
  "ä¸‰æ¨©åˆ†ç«‹ã¨ã¯ï¼Ÿ": "ä¸‰æ¨©åˆ†ç«‹ã¨ã¯ã€å›½å®¶æ¨©åŠ›ã‚’ç«‹æ³•æ¨©ï¼ˆå›½ä¼šï¼‰ã€è¡Œæ”¿æ¨©ï¼ˆå†…é–£ï¼‰ã€å¸æ³•æ¨©ï¼ˆè£åˆ¤æ‰€ï¼‰ã®3ã¤ã«åˆ†ã‘ã€ç›¸äº’ã«ç›£è¦–ãƒ»ç‰½åˆ¶ã•ã›ã‚‹åˆ¶åº¦ã§ã™ã€‚æ¨©åŠ›ã®é›†ä¸­ã‚’é˜²ãã€ç‹¬è£ã‚’é˜²æ­¢ã™ã‚‹æ°‘ä¸»ä¸»ç¾©ã®åŸºæœ¬åŸç†ã§ã™ã€‚æ—¥æœ¬å›½æ†²æ³•ã§ã‚‚æ¡ç”¨ã•ã‚Œã¦ãŠã‚Šã€å›½æ°‘ã®æ¨©åˆ©ã¨è‡ªç”±ã‚’å®ˆã‚‹é‡è¦ãªä»•çµ„ã¿ã§ã™ã€‚",
  
  "æ…£æ€§ã®æ³•å‰‡ã«ã¤ã„ã¦èª¬æ˜ã›ã‚ˆã€‚": "æ…£æ€§ã®æ³•å‰‡ï¼ˆãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³ã®ç¬¬ä¸€æ³•å‰‡ï¼‰ã¨ã¯ã€ã€Œç‰©ä½“ã¯å¤–åŠ›ãŒåƒã‹ãªã„é™ã‚Šã€é™æ­¢ã—ã¦ã„ã‚‹ç‰©ä½“ã¯é™æ­¢ã—ç¶šã‘ã€é‹å‹•ã—ã¦ã„ã‚‹ç‰©ä½“ã¯ç­‰é€Ÿç›´ç·šé‹å‹•ã‚’ç¶šã‘ã‚‹ã€ã¨ã„ã†æ³•å‰‡ã§ã™ã€‚ä¾‹ãˆã°ã€é›»è»ŠãŒæ€¥ãƒ–ãƒ¬ãƒ¼ã‚­ã‚’ã‹ã‘ã‚‹ã¨ä¹—å®¢ãŒå‰ã«å€’ã‚Œã‚‹ã®ã¯ã€ä¹—å®¢ã®ä½“ãŒç­‰é€Ÿç›´ç·šé‹å‹•ã‚’ç¶šã‘ã‚ˆã†ã¨ã™ã‚‹ãŸã‚ã§ã™ã€‚ã“ã®æ€§è³ªã‚’æ…£æ€§ã¨ã„ã„ã¾ã™ã€‚",
  
  "ç´°èƒåˆ†è£‚ã¨ã¯ä½•ã‹ï¼Ÿ": "ç´°èƒåˆ†è£‚ã¨ã¯ã€1ã¤ã®ç´°èƒãŒ2ã¤ä»¥ä¸Šã®ç´°èƒã«åˆ†ã‹ã‚Œã‚‹ç¾è±¡ã§ã™ã€‚ä¸»ã«ä½“ç´°èƒåˆ†è£‚ã¨æ¸›æ•°åˆ†è£‚ãŒã‚ã‚Šã¾ã™ã€‚ä½“ç´°èƒåˆ†è£‚ã§ã¯ã€DNAè¤‡è£½å¾Œã«æŸ“è‰²ä½“ãŒå‡ç­‰ã«åˆ†é…ã•ã‚Œã€éºä¼çš„ã«åŒã˜2ã¤ã®ç´°èƒãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šç”Ÿç‰©ã®æˆé•·ã‚„çµ„ç¹”ã®ä¿®å¾©ãŒè¡Œã‚ã‚Œã¾ã™ã€‚æ¸›æ•°åˆ†è£‚ã¯ç”Ÿæ®–ç´°èƒå½¢æˆæ™‚ã«èµ·ã“ã‚Šã€æŸ“è‰²ä½“æ•°ãŒåŠåˆ†ã«ãªã‚Šã¾ã™ã€‚",
  
  "SDGsã®æ„å‘³ã¨ç›®çš„ã¨ã¯ï¼Ÿ": "SDGsï¼ˆSustainable Development Goalsï¼‰ã¨ã¯ã€2015å¹´ã«å›½é€£ã§æ¡æŠã•ã‚ŒãŸã€ŒæŒç¶šå¯èƒ½ãªé–‹ç™ºç›®æ¨™ã€ã§ã™ã€‚2030å¹´ã¾ã§ã«é”æˆã™ã¹ã17ã®ç›®æ¨™ã‹ã‚‰ãªã‚Šã€ã€Œèª°ä¸€äººå–ã‚Šæ®‹ã•ãªã„ã€ç¤¾ä¼šã®å®Ÿç¾ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚è²§å›°æ’²æ»…ã€æ•™è‚²ã€ç’°å¢ƒä¿è­·ã€å¹³å’Œãªã©å¹…åºƒã„åˆ†é‡ã‚’ã‚«ãƒãƒ¼ã—ã€å…ˆé€²å›½ãƒ»é€”ä¸Šå›½ã™ã¹ã¦ãŒå–ã‚Šçµ„ã‚€æ™®éçš„ãªç›®æ¨™ã§ã™ã€‚",
  
  "åœ°éœ‡ã¨æ´¥æ³¢ã®é–¢ä¿‚ã¨ã¯ï¼Ÿ": "åœ°éœ‡ã¨æ´¥æ³¢ã¯å¯†æ¥ã«é–¢ä¿‚ã—ã¦ã„ã¾ã™ã€‚æµ·åº•ã§å¤§ããªåœ°éœ‡ãŒç™ºç”Ÿã™ã‚‹ã¨ã€ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ€¥æ¿€ãªå‹•ãã«ã‚ˆã‚Šæµ·åº•ãŒéš†èµ·ãƒ»æ²ˆé™ã—ã€å¤§é‡ã®æµ·æ°´ãŒæŠ¼ã—ä¸Šã’ã‚‰ã‚Œã¾ã™ã€‚ã“ã®æµ·æ°´ã®å¤‰å‹•ãŒæ³¢ã¨ãªã£ã¦å››æ–¹å…«æ–¹ã«ä¼æ’­ã™ã‚‹ã®ãŒæ´¥æ³¢ã§ã™ã€‚æ´¥æ³¢ã¯é€šå¸¸ã®æ³¢ã¨ç•°ãªã‚Šã€æ³¢é•·ãŒé•·ãã€æ²¿å²¸éƒ¨ã§é«˜ã•ãŒæ€¥æ¿€ã«å¢—å¤§ã™ã‚‹ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚",
  
  "å¤©æ°—ã¨æ°—å€™ã®é•ã„ã¯ï¼Ÿ": "å¤©æ°—ã¨ã¯ã€ã‚ã‚‹å ´æ‰€ã®çŸ­æœŸé–“ï¼ˆæ•°æ™‚é–“ã‹ã‚‰æ•°æ—¥ï¼‰ã®å¤§æ°—ã®çŠ¶æ…‹ã‚’æŒ‡ã—ã€æ°—æ¸©ã€æ¹¿åº¦ã€é™æ°´ã€é¢¨ãªã©ã§è¡¨ã•ã‚Œã¾ã™ã€‚ä¸€æ–¹ã€æ°—å€™ã¨ã¯ã€ã‚ã‚‹åœ°åŸŸã®é•·æœŸé–“ï¼ˆé€šå¸¸30å¹´ä»¥ä¸Šï¼‰ã®å¤©æ°—ã®å¹³å‡çš„ãªå‚¾å‘ã‚’æŒ‡ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€Œä»Šæ—¥ã¯é›¨ã€ã¯å¤©æ°—ã€ã€Œæ—¥æœ¬ã¯æ¸©å¸¯æ°—å€™ã€ã¯æ°—å€™ã®è©±ã§ã™ã€‚å¤©æ°—ã¯å¤‰ã‚ã‚Šã‚„ã™ãã€æ°—å€™ã¯å®‰å®šã—ã¦ã„ã¾ã™ã€‚",
  
  "GDPã¨ã¯ä½•ã‹ï¼Ÿ": "GDPï¼ˆGross Domestic Productï¼šå›½å†…ç·ç”Ÿç”£ï¼‰ã¨ã¯ã€ä¸€å®šæœŸé–“å†…ã«å›½å†…ã§ç”Ÿç”£ã•ã‚ŒãŸã™ã¹ã¦ã®è²¡ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®ä»˜åŠ ä¾¡å€¤ã®åˆè¨ˆã§ã™ã€‚å›½ã®çµŒæ¸ˆè¦æ¨¡ã‚„è±Šã‹ã•ã‚’æ¸¬ã‚‹é‡è¦ãªæŒ‡æ¨™ã§ã€æ¶ˆè²»ã€æŠ•è³‡ã€æ”¿åºœæ”¯å‡ºã€ç´”è¼¸å‡ºã®åˆè¨ˆã§è¨ˆç®—ã•ã‚Œã¾ã™ã€‚GDPãŒå¢—åŠ ã™ã‚‹ã¨çµŒæ¸ˆæˆé•·ã€æ¸›å°‘ã™ã‚‹ã¨çµŒæ¸ˆç¸®å°ã‚’æ„å‘³ã—ã¾ã™ã€‚",
  
  "æŒç¶šå¯èƒ½ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨ã¯ï¼Ÿ": "æŒç¶šå¯èƒ½ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨ã¯ã€å°†æ¥ä¸–ä»£ã®ãƒ‹ãƒ¼ã‚ºã‚’æãªã†ã“ã¨ãªãç¾åœ¨ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼éœ€è¦ã‚’æº€ãŸã™ã‚¨ãƒãƒ«ã‚®ãƒ¼ã§ã™ã€‚ä¸»ã«å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆå¤ªé™½å…‰ã€é¢¨åŠ›ã€æ°´åŠ›ã€åœ°ç†±ã€ãƒã‚¤ã‚ªãƒã‚¹ï¼‰ã‚’æŒ‡ã—ã¾ã™ã€‚åŒ–çŸ³ç‡ƒæ–™ã¨ç•°ãªã‚Šæ¯æ¸‡ã›ãšã€CO2æ’å‡ºé‡ãŒå°‘ãªã„ãŸã‚ç’°å¢ƒè² è·ãŒå°ã•ãã€é•·æœŸçš„ã«å®‰å®šä¾›çµ¦ãŒå¯èƒ½ãªç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚",
  
  "åœ°çƒæ¸©æš–åŒ–ã®åŸå› ã¨ã¯ï¼Ÿ": "åœ°çƒæ¸©æš–åŒ–ã®ä¸»ãªåŸå› ã¯ã€äººé–“æ´»å‹•ã«ã‚ˆã‚‹æ¸©å®¤åŠ¹æœã‚¬ã‚¹ï¼ˆCOâ‚‚ã€ãƒ¡ã‚¿ãƒ³ã€ãƒ•ãƒ­ãƒ³ãªã©ï¼‰ã®å¢—åŠ ã§ã™ã€‚ç‰¹ã«åŒ–çŸ³ç‡ƒæ–™ã®ç‡ƒç„¼ã«ã‚ˆã‚‹COâ‚‚æ’å‡ºãŒæœ€å¤§ã®è¦å› ã§ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¬ã‚¹ãŒå¤§æ°—ä¸­ã§ç†±ã‚’å¸åã—ã€åœ°çƒã®å¹³å‡æ°—æ¸©ã‚’ä¸Šæ˜‡ã•ã›ã¦ã„ã¾ã™ã€‚æ£®æ—ä¼æ¡ã«ã‚ˆã‚‹ COâ‚‚å¸åèƒ½åŠ›ã®ä½ä¸‹ã‚‚æ¸©æš–åŒ–ã‚’åŠ é€Ÿã•ã›ã¦ã„ã¾ã™ã€‚"
};
export const useFeedback = () => {
  const [loading, setLoading] = useState(false);
  const [feedback, setFeedback] = useState<FeedbackData | null>(null);
  const [error, setError] = useState<string | null>(null);
  const [currentTopic, setCurrentTopic] = useState<string>('');
  const [selectedSubject, setSelectedSubject] = useState<string>('å…¨æ•™ç§‘');
  const { addHistoryEntry } = useHistory();

  const generateRandomTopic = (subject?: string) => {
    const subjectToUse = subject || selectedSubject;
    let availableTopics: string[];
    
    if (subjectToUse === 'å…¨æ•™ç§‘') {
      availableTopics = ALL_TOPICS;
    } else {
      availableTopics = TOPICS_BY_SUBJECT[subjectToUse] || ALL_TOPICS;
    }
    
    const randomIndex = Math.floor(Math.random() * availableTopics.length);
    const topic = availableTopics[randomIndex];
    setCurrentTopic(topic);
    return topic;
  };

  const getCorrectAnswer = (topic: string): string => {
    return TOPIC_ANSWERS[topic] || '';
  };
  const analyzeFeedback = (text: string): FeedbackData => {
    // Parse the AI response to extract structured feedback
    const sections = {
      correct: '',
      mistakes: '',
      advice: '',
      accuracy: 3,
      clarity: 3
    };

    // Extract sections using regex patterns
    const correctMatch = text.match(/âœ…[^âŒğŸ’¡ğŸ“Š]*/);
    const mistakeMatch = text.match(/âŒ[^âœ…ğŸ’¡ğŸ“Š]*/);
    const adviceMatch = text.match(/ğŸ’¡[^âœ…âŒğŸ“Š]*/);
    const scoreMatch = text.match(/ğŸ“Š.*?(\d)[^0-9]*?(\d)/);

    if (correctMatch) {
      sections.correct = correctMatch[0].replace('âœ…', '').trim();
    }

    if (mistakeMatch) {
      sections.mistakes = mistakeMatch[0].replace('âŒ', '').trim();
    }

    if (adviceMatch) {
      sections.advice = adviceMatch[0].replace('ğŸ’¡', '').trim();
    }

    if (scoreMatch) {
      sections.accuracy = parseInt(scoreMatch[1]) || 3;
      sections.clarity = parseInt(scoreMatch[2]) || 3;
    }

    return sections;
  };

  const submitExplanation = async (explanation: string, topic?: string, mode: 'random' | 'custom' = 'random') => {
    if (!explanation.trim()) {
      setError('èª¬æ˜æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }

    const topicToUse = topic || currentTopic;
    if (!topicToUse) {
      setError('ãƒ†ãƒ¼ãƒãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
      return;
    }

    setLoading(true);
    setError(null);

    try {
      // Simulate AI response (in a real app, this would call an AI API)
      await new Promise(resolve => setTimeout(resolve, 2000));

      // Mock AI response based on the explanation
      const mockResponse = generateMockFeedback(explanation, topicToUse);
      const parsedFeedback = analyzeFeedback(mockResponse);
      
      setFeedback(parsedFeedback);
      
      // Add to history
      addHistoryEntry(topicToUse, explanation, parsedFeedback, mode);
    } catch (err) {
      setError('ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
    } finally {
      setLoading(false);
    }
  };

  const generateMockFeedback = (explanation: string, topic: string): string => {
    // Generate realistic feedback based on explanation content
    const wordCount = explanation.split(' ').length;
    const hasExamples = explanation.includes('ä¾‹ãˆã°') || explanation.includes('ãŸã¨ãˆã°');
    const hasConclusion = explanation.includes('ã¤ã¾ã‚Š') || explanation.includes('ã—ãŸãŒã£ã¦');
    
    let accuracy = Math.min(5, Math.max(2, Math.floor(wordCount / 20) + 2));
    let clarity = hasExamples && hasConclusion ? 5 : hasExamples || hasConclusion ? 4 : 3;

    // Topic-specific feedback adjustments
    const topicKeywords = getTopicKeywords(topic);
    const hasRelevantKeywords = topicKeywords.some(keyword => 
      explanation.toLowerCase().includes(keyword.toLowerCase())
    );
    
    if (hasRelevantKeywords) {
      accuracy = Math.min(5, accuracy + 1);
    }
    return `âœ…æ­£ã—ã„ç‚¹ï¼š
ãŠé¡Œã€Œ${topic}ã€ã«å¯¾ã—ã¦åŸºæœ¬çš„ãªæ¦‚å¿µã‚’ç†è§£ã§ãã¦ãŠã‚Šã€è‡ªåˆ†ã®è¨€è‘‰ã§è¡¨ç¾ã—ã‚ˆã†ã¨ã™ã‚‹å§¿å‹¢ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚${hasExamples ? 'å…·ä½“ä¾‹ã‚’ä½¿ã£ã¦èª¬æ˜ã—ã¦ã„ã‚‹ç‚¹ã‚‚è‰¯ã„ã§ã™ã­ã€‚' : ''}${hasRelevantKeywords ? 'é‡è¦ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é©åˆ‡ã«ä½¿ç”¨ã§ãã¦ã„ã¾ã™ã€‚' : ''}

âŒé–“é•ã„ã‚„ä¸æ˜ç­ãªç‚¹ï¼š
${wordCount < 30 ? 'èª¬æ˜ãŒã‚„ã‚„ç°¡æ½”ã™ãã¦ã€è©³ç´°ãŒä¸è¶³ã—ã¦ã„ã‚‹éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚' : ''}${!hasConclusion ? 'çµè«–ã‚„è¦ç‚¹ã®ã¾ã¨ã‚ãŒã‚ã‚‹ã¨ã‚ˆã‚Šç†è§£ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚' : ''}${!hasRelevantKeywords ? 'ã“ã®ãŠé¡Œã«é–¢é€£ã™ã‚‹å°‚é–€ç”¨èªã‚’ã‚‚ã†å°‘ã—ä½¿ç”¨ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚' : ''}

ğŸ’¡æ”¹å–„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼š
${!hasExamples ? 'å…·ä½“ä¾‹ã‚„èº«è¿‘ãªä¾‹ã‚’åŠ ãˆã‚‹ã¨ã€ã‚ˆã‚Šç†è§£ã—ã‚„ã™ã„èª¬æ˜ã«ãªã‚Šã¾ã™ã€‚' : ''}æ§‹é€ åŒ–ã•ã‚ŒãŸèª¬æ˜ï¼ˆåºè«–ãƒ»æœ¬è«–ãƒ»çµè«–ï¼‰ã‚’æ„è­˜ã™ã‚‹ã¨ã€èãæ‰‹ã«ã‚ˆã‚Šä¼ã‚ã‚Šã‚„ã™ããªã‚‹ã§ã—ã‚‡ã†ã€‚ã€Œ${topic}ã€ã«ã¤ã„ã¦èª¬æ˜ã™ã‚‹éš›ã¯ã€${getTopicAdvice(topic)}

ğŸ“Šè©•ä¾¡ã‚¹ã‚³ã‚¢ï¼š
æ­£ç¢ºã•: ${accuracy}/5
ã‚ã‹ã‚Šã‚„ã™ã•: ${clarity}/5`;
  };

  const getTopicKeywords = (topic: string): string[] => {
    const keywordMap: { [key: string]: string[] } = {
      'ä¸€æ¬¡é–¢æ•°': ['å‚¾ã', 'yåˆ‡ç‰‡', 'ã‚°ãƒ©ãƒ•', 'æ¯”ä¾‹'],
      'äºŒæ¬¡æ–¹ç¨‹å¼': ['è§£ã®å…¬å¼', 'å› æ•°åˆ†è§£', 'åˆ¤åˆ¥å¼', 'å¹³æ–¹å®Œæˆ'],
      'ä¸‰è§’æ¯”': ['sin', 'cos', 'tan', 'ç›´è§’ä¸‰è§’å½¢'],
      'ç¢ºç‡': ['å ´åˆã®æ•°', 'äº‹è±¡', 'ç‹¬ç«‹', 'æ’å'],
      'é£Ÿç‰©é€£é–': ['ç”Ÿç”£è€…', 'æ¶ˆè²»è€…', 'åˆ†è§£è€…', 'ç”Ÿæ…‹ç³»'],
      'å…‰åˆæˆ': ['ã‚¯ãƒ­ãƒ­ãƒ•ã‚£ãƒ«', 'è‘‰ç·‘ä½“', 'äºŒé…¸åŒ–ç‚­ç´ ', 'é…¸ç´ '],
      'é…¸åŒ–': ['é›»å­', 'é‚„å…ƒ', 'é…¸ç´ ', 'åŒ–å­¦åå¿œ'],
      'éŒå€‰å¹•åºœ': ['æºé ¼æœ', 'æ­¦å£«', 'å®ˆè­·', 'åœ°é ­'],
      'æ˜æ²»ç¶­æ–°': ['å»ƒè—©ç½®çœŒ', 'æ–‡æ˜é–‹åŒ–', 'å¯Œå›½å¼·å…µ', 'è¿‘ä»£åŒ–'],
      'ä¸‰æ¨©åˆ†ç«‹': ['ç«‹æ³•', 'è¡Œæ”¿', 'å¸æ³•', 'æ¨©åŠ›'],
      'æ…£æ€§ã®æ³•å‰‡': ['ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³', 'ç¬¬ä¸€æ³•å‰‡', 'é™æ­¢', 'ç­‰é€Ÿç›´ç·šé‹å‹•'],
      'ç´°èƒåˆ†è£‚': ['DNA', 'æŸ“è‰²ä½“', 'ä½“ç´°èƒåˆ†è£‚', 'æ¸›æ•°åˆ†è£‚'],
      'SDGs': ['æŒç¶šå¯èƒ½', 'é–‹ç™ºç›®æ¨™', 'å›½é€£', '2030å¹´'],
      'åœ°éœ‡': ['ãƒ—ãƒ¬ãƒ¼ãƒˆ', 'éœ‡æº', 'ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰', 'éœ‡åº¦'],
      'å¤©æ°—': ['æ°—è±¡', 'çŸ­æœŸé–“', 'å±€åœ°çš„', 'å¤‰åŒ–'],
      'GDP': ['å›½å†…ç·ç”Ÿç”£', 'çµŒæ¸ˆæŒ‡æ¨™', 'ä»˜åŠ ä¾¡å€¤', 'å›½ã®è±Šã‹ã•'],
      'æŒç¶šå¯èƒ½': ['å†ç”Ÿå¯èƒ½', 'ç’°å¢ƒ', 'å°†æ¥ä¸–ä»£', 'å¾ªç’°'],
      'åœ°çƒæ¸©æš–åŒ–': ['æ¸©å®¤åŠ¹æœã‚¬ã‚¹', 'COâ‚‚', 'åŒ–çŸ³ç‡ƒæ–™', 'æ°—å€™å¤‰å‹•']
    };
    
    for (const [key, keywords] of Object.entries(keywordMap)) {
      if (topic.includes(key)) {
        return keywords;
      }
    }
    return [];
  };

  const getTopicAdvice = (topic: string): string => {
    const adviceMap: { [key: string]: string } = {
      'ä¸€æ¬¡é–¢æ•°': 'æ•°å¼ã¨ã‚°ãƒ©ãƒ•ã®é–¢ä¿‚ã‚’æ˜ç¢ºã«èª¬æ˜ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚',
      'äºŒæ¬¡æ–¹ç¨‹å¼': 'è§£æ³•ã®æ‰‹é †ã‚’æ®µéšçš„ã«ç¤ºã—ã€åˆ¤åˆ¥å¼ã®æ„å‘³ã‚‚èª¬æ˜ã—ã¾ã—ã‚‡ã†ã€‚',
      'ä¸‰è§’æ¯”': 'ç›´è§’ä¸‰è§’å½¢ã§ã®å®šç¾©ã‹ã‚‰å§‹ã‚ã¦ã€å…·ä½“çš„ãªè§’åº¦ã§ã®å€¤ã‚‚ç¤ºã™ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚',
      'ç¢ºç‡': 'å…·ä½“ä¾‹ã‚’ä½¿ã£ã¦è¨ˆç®—éç¨‹ã‚’ç¤ºã™ã¨ç†è§£ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚',
      'é£Ÿç‰©é€£é–': 'å„æ®µéšã®å½¹å‰²ã¨ç›¸äº’é–¢ä¿‚ã‚’å…·ä½“çš„ã«ç¤ºã™ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚',
      'å…‰åˆæˆ': 'åŒ–å­¦å¼ã¨åå¿œã®å ´æ‰€ï¼ˆè‘‰ç·‘ä½“ï¼‰ã‚’æ˜ç¢ºã«èª¬æ˜ã—ã¦ãã ã•ã„ã€‚',
      'é…¸åŒ–': 'é›»å­ã®ç§»å‹•ã¨ã„ã†è¦³ç‚¹ã‹ã‚‰èª¬æ˜ã™ã‚‹ã¨ç†è§£ãŒæ·±ã¾ã‚Šã¾ã™ã€‚',
      'éŒå€‰å¹•åºœ': 'æ™‚ä»£èƒŒæ™¯ã¨æ”¿æ²»åˆ¶åº¦ã®ç‰¹å¾´ã‚’é–¢é€£ä»˜ã‘ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚',
      'æ˜æ²»ç¶­æ–°': 'ç¤¾ä¼šåˆ¶åº¦ã®å¤‰åŒ–ã‚’å…·ä½“ä¾‹ã¨ã¨ã‚‚ã«èª¬æ˜ã™ã‚‹ã¨åŠ¹æœçš„ã§ã™ã€‚',
      'ä¸‰æ¨©åˆ†ç«‹': 'å„æ¨©åŠ›ã®å½¹å‰²ã¨ç›¸äº’ã®é–¢ä¿‚ã‚’æ˜ç¢ºã«ç¤ºã—ã¾ã—ã‚‡ã†ã€‚',
      'æ…£æ€§ã®æ³•å‰‡': 'æ—¥å¸¸ç”Ÿæ´»ã®å…·ä½“ä¾‹ã‚’ä½¿ã£ã¦æ³•å‰‡ã‚’èª¬æ˜ã™ã‚‹ã¨ç†è§£ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚',
      'ç´°èƒåˆ†è£‚': 'éç¨‹ã‚’æ®µéšçš„ã«èª¬æ˜ã—ã€ãã®æ„ç¾©ã‚‚å«ã‚ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚',
      'SDGs': '17ã®ç›®æ¨™ã®ä¸­ã‹ã‚‰å…·ä½“ä¾‹ã‚’æŒ™ã’ã¦èª¬æ˜ã™ã‚‹ã¨åŠ¹æœçš„ã§ã™ã€‚',
      'åœ°éœ‡': 'ç™ºç”Ÿãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨è¢«å®³ã®é–¢ä¿‚ã‚’æ˜ç¢ºã«èª¬æ˜ã—ã¦ãã ã•ã„ã€‚',
      'å¤©æ°—': 'æ°—å€™ã¨ã®é•ã„ã‚’æ˜ç¢ºã«ã—ã€å¤‰åŒ–ã®è¦å› ã‚‚èª¬æ˜ã—ã¾ã—ã‚‡ã†ã€‚',
      'GDP': 'è¨ˆç®—æ–¹æ³•ã‚„ä»–ã®çµŒæ¸ˆæŒ‡æ¨™ã¨ã®é•ã„ã‚‚è§¦ã‚Œã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚',
      'æŒç¶šå¯èƒ½': 'å…·ä½“çš„ãªå–ã‚Šçµ„ã¿ä¾‹ã‚’æŒ™ã’ã¦èª¬æ˜ã™ã‚‹ã¨ç†è§£ãŒæ·±ã¾ã‚Šã¾ã™ã€‚',
      'åœ°çƒæ¸©æš–åŒ–': 'åŸå› ã¨å½±éŸ¿ã‚’å…·ä½“çš„ãªãƒ‡ãƒ¼ã‚¿ã¨ã¨ã‚‚ã«èª¬æ˜ã—ã¾ã—ã‚‡ã†ã€‚'
    };
    
    for (const [key, advice] of Object.entries(adviceMap)) {
      if (topic.includes(key)) {
        return advice;
      }
    }
    return 'é–¢é€£ã™ã‚‹å°‚é–€ç”¨èªã‚’é©åˆ‡ã«ä½¿ç”¨ã—ã€å…·ä½“ä¾‹ã‚’äº¤ãˆã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚';
  };
  const clearFeedback = () => {
    setFeedback(null);
    setError(null);
  };

  return {
    loading,
    feedback,
    error,
    currentTopic,
    selectedSubject,
    setSelectedSubject,
    availableSubjects: ['å…¨æ•™ç§‘', ...Object.keys(TOPICS_BY_SUBJECT)],
    generateRandomTopic,
    getCorrectAnswer,
    submitExplanation,
    clearFeedback
  };
};